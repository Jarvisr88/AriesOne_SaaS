# Database Migrations

This directory contains database migrations for the AriesOne SaaS application.

## Structure

- `versions/`: Contains all migration scripts
- `env.py`: Alembic environment configuration
- `script.py.mako`: Template for new migration scripts

## Usage

### Create a New Migration

```bash
# Create a new migration
alembic revision --autogenerate -m "description_of_changes"
```

### Run Migrations

```bash
# Run all pending migrations
alembic upgrade head

# Rollback last migration
alembic downgrade -1

# Rollback to specific migration
alembic downgrade <revision_id>

# View migration history
alembic history --verbose
```

### Best Practices

1. Always review autogenerated migrations before applying them
2. Test migrations on a staging database before production
3. Include both upgrade and downgrade paths
4. Keep migrations idempotent
5. Add appropriate indexes for performance
6. Use transactions for data consistency

## Initial Schema

The initial schema migration (`2025_01_10_0957_initial_schema.py`) creates:

### Ability Module Tables
- `credentials`: Base credentials table
- `clerk_credentials`: Clerk-specific credentials
- `eligibility_credentials`: Eligibility-related credentials
- `envelope_credentials`: Envelope-related credentials
- `integration_settings`: Integration configuration settings

### Common Module Tables
- `errors`: Error logging table
- `file_metadata`: File metadata storage

### Indexes
- `ix_errors_created_at`: Index on error creation time
- `ix_errors_user_id`: Index on error user ID
- `ix_file_metadata_user_id`: Index on file user ID
- `ix_file_metadata_created_at`: Index on file creation time
